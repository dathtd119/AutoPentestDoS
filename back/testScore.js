const fs = require('fs');

const OUTPUT_DIR = "./output/";


function getInfoByType(scanId,type) {
    const filePath = `${OUTPUT_DIR}${scanId}-${type}.json`; // Use template literal for flexibility
    try {
      const data = fs.readFileSync(filePath, 'utf8');
      return JSON.parse(data);
    } catch (err) {
      if (err.code === 'ENOENT') { // Handle file not found error
        return { error: 'Scan not found' };
      } else {
        throw err; // Re-throw other errors
      }
    }
  }
  


  function calculateAverageScore(data) {
    let totalScore = 0;
    let numScores = 0;
  
    function traverseObject(obj) {
      for (const key in obj) {
        if (typeof obj[key] === 'object') {
          if (Array.isArray(obj[key])) {
            for (const item of obj[key]) {
              traverseObject(item);
            }
          } else {
            traverseObject(obj[key]);
          }
        } else if (key === 'score') {
          totalScore += obj[key];
          numScores++;
        }
      }
    }
  
    traverseObject(data);
  
    if (numScores === 0) {
      return 'No scores found';
    }
  
    return totalScore / numScores;
  }
  
  // Example usage
  const jsonData = {
    "result": [
      {
        "Layer 3": [
          {
            "HPing3": {
              "Flood": {
                "ICMP Flood": {
                  "success": true,
                  "avgPing": 0.376,
                  "maxPing": 0.504,
                  "packetLossPercentage": 20
                }
              }
            }
          }
        ]
      },
      {
        "Layer 4": [
          {
            "HPing3": {
              "Flood": {
                "TCP Reset Flood": {
                  "success": true,
                  "avgPing": 1.699,
                  "maxPing": 7.862,
                  "packetLossPercentage": 10
                },
                "TCP SYN FIN Flood": {
                  "success": false,
                  "avgPing": 4.128,
                  "maxPing": 21.723,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "TCP PUSH ACK Flood": {
                  "success": false,
                  "avgPing": 2.359,
                  "maxPing": 5.385,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "TCP FIN Flood": {
                  "success": true,
                  "avgPing": 1.359,
                  "maxPing": 7.238,
                  "packetLossPercentage": 20
                },
                "UDP Flood": {
                  "success": true,
                  "avgPing": 1.418,
                  "maxPing": 4.038,
                  "packetLossPercentage": 30
                }
              }
            }
          }
        ]
      },
      {
        "Layer 7": [
          {
            "MHDDoS": {
              "Flood": {
                "GET Flood": {
                  "success": false,
                  "avgPing": 0.178,
                  "maxPing": 0.215,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "POST Flood": {
                  "success": false,
                  "avgPing": 0.371,
                  "maxPing": 0.528,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "GET Method with more header": {
                  "success": false,
                  "avgPing": 0.428,
                  "maxPing": 0.558,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "HEAD Flood": {
                  "success": false,
                  "avgPing": 0.514,
                  "maxPing": 0.876,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "Null UserAgent Flood": {
                  "success": false,
                  "avgPing": 0.613,
                  "maxPing": 0.782,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "Random Cookie Flood": {
                  "success": false,
                  "avgPing": 0.713,
                  "maxPing": 0.745,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "Slowloris": {
                  "success": false,
                  "avgPing": 0.765,
                  "maxPing": 0.794,
                  "packetLossPercentage": 0,
                  "score": 8
                }
              },
              "Other": {
                "Sends HTTP packets with high byte": {
                  "success": false,
                  "avgPing": 0.501,
                  "maxPing": 0.742,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "Reading data slowly": {
                  "success": false,
                  "avgPing": 0.108,
                  "maxPing": 0.109,
                  "packetLossPercentage": 0,
                  "score": 8
                },
                "Bypasses normal AntiDDoS": {
                  "success": false,
                  "avgPing": 0.346,
                  "maxPing": 0.469,
                  "packetLossPercentage": 0,
                  "score": 8
                }
              }
            }
          }
        ]
      }
    ]
  };
  
  const averageScore = calculateAverageScore(jsonData);
  console.log('Average Score:', averageScore);


